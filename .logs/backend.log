INFO:     Will watch for changes in these directories: ['/root/aioffer/backend']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [1989235] using WatchFiles
INFO:     Started server process [1989273]
INFO:     Waiting for application startup.
2026-01-13 23:06:50 - main - INFO - 正在初始化数据库...
2026-01-13 23:06:50,988 INFO sqlalchemy.engine.Engine SELECT DATABASE()
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - SELECT DATABASE()
2026-01-13 23:06:50,988 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:50,989 INFO sqlalchemy.engine.Engine SELECT @@sql_mode
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - SELECT @@sql_mode
2026-01-13 23:06:50,990 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:50,990 INFO sqlalchemy.engine.Engine SELECT @@lower_case_table_names
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - SELECT @@lower_case_table_names
2026-01-13 23:06:50,990 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:50,991 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:06:50,992 INFO sqlalchemy.engine.Engine DESCRIBE `admin_system`.`users`
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - DESCRIBE `admin_system`.`users`
2026-01-13 23:06:50,992 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:50,993 INFO sqlalchemy.engine.Engine DESCRIBE `admin_system`.`user_auths`
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - DESCRIBE `admin_system`.`user_auths`
2026-01-13 23:06:50,993 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:50,995 INFO sqlalchemy.engine.Engine DESCRIBE `admin_system`.`email_verification_codes`
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - DESCRIBE `admin_system`.`email_verification_codes`
2026-01-13 23:06:50,995 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:50,996 INFO sqlalchemy.engine.Engine DESCRIBE `admin_system`.`login_logs`
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - DESCRIBE `admin_system`.`login_logs`
2026-01-13 23:06:50,996 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:50,997 INFO sqlalchemy.engine.Engine DESCRIBE `admin_system`.`members`
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - DESCRIBE `admin_system`.`members`
2026-01-13 23:06:50,997 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:50,998 INFO sqlalchemy.engine.Engine DESCRIBE `admin_system`.`user_roles`
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - DESCRIBE `admin_system`.`user_roles`
2026-01-13 23:06:50,998 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:50,999 INFO sqlalchemy.engine.Engine DESCRIBE `admin_system`.`role_permissions`
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - DESCRIBE `admin_system`.`role_permissions`
2026-01-13 23:06:50,999 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:50 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:51,000 INFO sqlalchemy.engine.Engine DESCRIBE `admin_system`.`roles`
2026-01-13 23:06:51 - sqlalchemy.engine.Engine - INFO - DESCRIBE `admin_system`.`roles`
2026-01-13 23:06:51,000 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:51 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:51,001 INFO sqlalchemy.engine.Engine DESCRIBE `admin_system`.`permissions`
2026-01-13 23:06:51 - sqlalchemy.engine.Engine - INFO - DESCRIBE `admin_system`.`permissions`
2026-01-13 23:06:51,001 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:51 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:51,002 INFO sqlalchemy.engine.Engine DESCRIBE `admin_system`.`menus`
2026-01-13 23:06:51 - sqlalchemy.engine.Engine - INFO - DESCRIBE `admin_system`.`menus`
2026-01-13 23:06:51,002 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:51 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:51,003 INFO sqlalchemy.engine.Engine DESCRIBE `admin_system`.`orders`
2026-01-13 23:06:51 - sqlalchemy.engine.Engine - INFO - DESCRIBE `admin_system`.`orders`
2026-01-13 23:06:51,003 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:51 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:51,005 INFO sqlalchemy.engine.Engine DESCRIBE `admin_system`.`point_transactions`
2026-01-13 23:06:51 - sqlalchemy.engine.Engine - INFO - DESCRIBE `admin_system`.`point_transactions`
2026-01-13 23:06:51,005 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:51 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:51,006 INFO sqlalchemy.engine.Engine DESCRIBE `admin_system`.`external_systems`
2026-01-13 23:06:51 - sqlalchemy.engine.Engine - INFO - DESCRIBE `admin_system`.`external_systems`
2026-01-13 23:06:51,006 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:51 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:51,007 INFO sqlalchemy.engine.Engine DESCRIBE `admin_system`.`system_configs`
2026-01-13 23:06:51 - sqlalchemy.engine.Engine - INFO - DESCRIBE `admin_system`.`system_configs`
2026-01-13 23:06:51,007 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-01-13 23:06:51 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-13 23:06:51,008 INFO sqlalchemy.engine.Engine COMMIT
2026-01-13 23:06:51 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-13 23:06:51 - main - INFO - 数据库初始化完成
INFO:     Application startup complete.
2026-01-13 23:07:00,502 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:07:00,506 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.username = %s
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.username = %s
2026-01-13 23:07:00,506 INFO sqlalchemy.engine.Engine [generated in 0.00028s] ('user2',)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] ('user2',)
2026-01-13 23:07:00,509 INFO sqlalchemy.engine.Engine SELECT members.user_id AS members_user_id, members.id AS members_id, members.member_level AS members_member_level, members.points AS members_points, members.balance AS members_balance, members.expired_at AS members_expired_at, members.created_at AS members_created_at, members.updated_at AS members_updated_at 
FROM members 
WHERE members.user_id IN (%s)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT members.user_id AS members_user_id, members.id AS members_id, members.member_level AS members_member_level, members.points AS members_points, members.balance AS members_balance, members.expired_at AS members_expired_at, members.created_at AS members_created_at, members.updated_at AS members_updated_at 
FROM members 
WHERE members.user_id IN (%s)
2026-01-13 23:07:00,509 INFO sqlalchemy.engine.Engine [generated in 0.00030s] (10,)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] (10,)
2026-01-13 23:07:00,763 INFO sqlalchemy.engine.Engine INSERT INTO login_logs (user_id, auth_type, identifier, ip, user_agent, success, failure_reason) VALUES (%s, %s, %s, %s, %s, %s, %s)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - INSERT INTO login_logs (user_id, auth_type, identifier, ip, user_agent, success, failure_reason) VALUES (%s, %s, %s, %s, %s, %s, %s)
2026-01-13 23:07:00,763 INFO sqlalchemy.engine.Engine [generated in 0.00030s] (10, 'username', 'user2', '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36', 1, None)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] (10, 'username', 'user2', '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36', 1, None)
2026-01-13 23:07:00,765 INFO sqlalchemy.engine.Engine COMMIT
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-13 23:07:00 - routers.auth - INFO - 用户登录成功: user2
INFO:     127.0.0.1:50242 - "POST /api/auth/login HTTP/1.1" 200 OK
DEBUG: get_current_user called. Token: eyJhbGciOi...
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-13 23:07:00,949 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:07:00,950 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:07:00,950 INFO sqlalchemy.engine.Engine [generated in 0.00023s] (10,)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] (10,)
2026-01-13 23:07:00,953 INFO sqlalchemy.engine.Engine SELECT count(users.id) AS count_1 
FROM users
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users
2026-01-13 23:07:00,953 INFO sqlalchemy.engine.Engine [generated in 0.00038s] ()
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] ()
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-13 23:07:00,955 INFO sqlalchemy.engine.Engine SELECT count(users.id) AS count_1 
FROM users 
WHERE users.status = %s
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users 
WHERE users.status = %s
2026-01-13 23:07:00,956 INFO sqlalchemy.engine.Engine [generated in 0.00027s] (1,)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (1,)
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-13 23:07:00,959 INFO sqlalchemy.engine.Engine SELECT count(users.id) AS count_1 
FROM users 
WHERE date(users.created_at) = %s
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users 
WHERE date(users.created_at) = %s
2026-01-13 23:07:00,959 INFO sqlalchemy.engine.Engine [generated in 0.00025s] (datetime.date(2026, 1, 13),)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (datetime.date(2026, 1, 13),)
2026-01-13 23:07:00,959 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:07:00,960 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:07:00,960 INFO sqlalchemy.engine.Engine [cached since 0.01001s ago] (10,)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [cached since 0.01001s ago] (10,)
2026-01-13 23:07:00,961 INFO sqlalchemy.engine.Engine SELECT sum(members.points) AS sum_1 
FROM members
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT sum(members.points) AS sum_1 
FROM members
2026-01-13 23:07:00,962 INFO sqlalchemy.engine.Engine [generated in 0.00022s] ()
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2026-01-13 23:07:00,965 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s) AS anon_1
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s) AS anon_1
2026-01-13 23:07:00,965 INFO sqlalchemy.engine.Engine [generated in 0.00027s] (10,)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (10,)
INFO:     127.0.0.1:50256 - "GET /api/users/stats HTTP/1.1" 200 OK
2026-01-13 23:07:00,966 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - ROLLBACK
sys:1: SAWarning: SELECT statement has a cartesian product between FROM element(s) "orders" and FROM element "anon_1".  Apply join condition(s) between each element to resolve.
2026-01-13 23:07:00,968 INFO sqlalchemy.engine.Engine SELECT sum(orders.amount) AS sum_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s) AS anon_1, orders
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT sum(orders.amount) AS sum_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s) AS anon_1, orders
2026-01-13 23:07:00,968 INFO sqlalchemy.engine.Engine [generated in 0.00024s] (10,)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] (10,)
2026-01-13 23:07:00,969 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:07:00,969 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:07:00,969 INFO sqlalchemy.engine.Engine [cached since 0.01928s ago] (10,)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [cached since 0.01928s ago] (10,)
2026-01-13 23:07:00,970 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:07:00,970 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:07:00,970 INFO sqlalchemy.engine.Engine [cached since 0.02021s ago] (10,)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [cached since 0.02021s ago] (10,)
2026-01-13 23:07:00,972 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s AND orders.status = %s) AS anon_1
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s AND orders.status = %s) AS anon_1
2026-01-13 23:07:00,972 INFO sqlalchemy.engine.Engine [generated in 0.00026s] (10, 1)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (10, 1)
2026-01-13 23:07:00,975 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s ORDER BY orders.created_at DESC) AS anon_1
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s ORDER BY orders.created_at DESC) AS anon_1
2026-01-13 23:07:00,975 INFO sqlalchemy.engine.Engine [generated in 0.00025s] (10,)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (10,)
INFO:     127.0.0.1:50288 - "GET /api/users/transactions?page=1&size=6 HTTP/1.1" 200 OK
2026-01-13 23:07:00,976 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:07:00,977 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s AND orders.status = %s) AS anon_1
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s AND orders.status = %s) AS anon_1
2026-01-13 23:07:00,977 INFO sqlalchemy.engine.Engine [cached since 0.005217s ago] (10, 2)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [cached since 0.005217s ago] (10, 2)
INFO:     127.0.0.1:50272 - "GET /api/orders/stats HTTP/1.1" 200 OK
2026-01-13 23:07:00,979 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:07:00,982 INFO sqlalchemy.engine.Engine SELECT orders.id, orders.order_no, orders.user_id, orders.product_id, orders.product_type, orders.amount, orders.quantity, orders.status, orders.payment_method, orders.payment_time, orders.description, orders.created_at, orders.updated_at 
FROM orders 
WHERE orders.user_id = %s ORDER BY orders.created_at DESC 
 LIMIT %s, %s
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT orders.id, orders.order_no, orders.user_id, orders.product_id, orders.product_type, orders.amount, orders.quantity, orders.status, orders.payment_method, orders.payment_time, orders.description, orders.created_at, orders.updated_at 
FROM orders 
WHERE orders.user_id = %s ORDER BY orders.created_at DESC 
 LIMIT %s, %s
2026-01-13 23:07:00,982 INFO sqlalchemy.engine.Engine [generated in 0.00028s] (10, 0, 6)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (10, 0, 6)
DEBUG: get_current_user called. Token: eyJhbGciOi...
INFO:     127.0.0.1:50280 - "GET /api/orders/?page=1&size=6 HTTP/1.1" 200 OK
2026-01-13 23:07:00,984 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:07:00,985 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:07:00,985 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:07:00,985 INFO sqlalchemy.engine.Engine [cached since 0.03505s ago] (10,)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [cached since 0.03505s ago] (10,)
2026-01-13 23:07:00,986 INFO sqlalchemy.engine.Engine SELECT count(users.id) AS count_1 
FROM users
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users
2026-01-13 23:07:00,987 INFO sqlalchemy.engine.Engine [cached since 0.03409s ago] ()
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [cached since 0.03409s ago] ()
2026-01-13 23:07:00,988 INFO sqlalchemy.engine.Engine SELECT count(users.id) AS count_1 
FROM users 
WHERE users.status = %s
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users 
WHERE users.status = %s
2026-01-13 23:07:00,988 INFO sqlalchemy.engine.Engine [cached since 0.03239s ago] (1,)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [cached since 0.03239s ago] (1,)
2026-01-13 23:07:00,989 INFO sqlalchemy.engine.Engine SELECT count(users.id) AS count_1 
FROM users 
WHERE date(users.created_at) = %s
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users 
WHERE date(users.created_at) = %s
2026-01-13 23:07:00,989 INFO sqlalchemy.engine.Engine [cached since 0.03029s ago] (datetime.date(2026, 1, 13),)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [cached since 0.03029s ago] (datetime.date(2026, 1, 13),)
2026-01-13 23:07:00,990 INFO sqlalchemy.engine.Engine SELECT sum(members.points) AS sum_1 
FROM members
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT sum(members.points) AS sum_1 
FROM members
2026-01-13 23:07:00,990 INFO sqlalchemy.engine.Engine [cached since 0.02898s ago] ()
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [cached since 0.02898s ago] ()
INFO:     127.0.0.1:50290 - "GET /api/users/stats HTTP/1.1" 200 OK
2026-01-13 23:07:00,991 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - ROLLBACK
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-13 23:07:00,995 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:07:00,995 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:07:00,996 INFO sqlalchemy.engine.Engine [cached since 0.04565s ago] (10,)
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - [cached since 0.04565s ago] (10,)
INFO:     127.0.0.1:50294 - "GET /api/users/transactions?page=1&size=6 HTTP/1.1" 200 OK
2026-01-13 23:07:00,997 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:07:00 - sqlalchemy.engine.Engine - INFO - ROLLBACK
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-13 23:07:01,001 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:07:01,001 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:07:01,001 INFO sqlalchemy.engine.Engine [cached since 0.05149s ago] (10,)
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - [cached since 0.05149s ago] (10,)
2026-01-13 23:07:01,003 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s) AS anon_1
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s) AS anon_1
2026-01-13 23:07:01,003 INFO sqlalchemy.engine.Engine [cached since 0.03845s ago] (10,)
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - [cached since 0.03845s ago] (10,)
sys:1: SAWarning: SELECT statement has a cartesian product between FROM element(s) "anon_1" and FROM element "orders".  Apply join condition(s) between each element to resolve.
2026-01-13 23:07:01,005 INFO sqlalchemy.engine.Engine SELECT sum(orders.amount) AS sum_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s) AS anon_1, orders
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - SELECT sum(orders.amount) AS sum_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s) AS anon_1, orders
2026-01-13 23:07:01,005 INFO sqlalchemy.engine.Engine [generated in 0.00024s] (10,)
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] (10,)
2026-01-13 23:07:01,007 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s AND orders.status = %s) AS anon_1
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s AND orders.status = %s) AS anon_1
2026-01-13 23:07:01,007 INFO sqlalchemy.engine.Engine [cached since 0.03502s ago] (10, 1)
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - [cached since 0.03502s ago] (10, 1)
2026-01-13 23:07:01,008 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s AND orders.status = %s) AS anon_1
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s AND orders.status = %s) AS anon_1
2026-01-13 23:07:01,008 INFO sqlalchemy.engine.Engine [cached since 0.03633s ago] (10, 2)
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - [cached since 0.03633s ago] (10, 2)
INFO:     127.0.0.1:50296 - "GET /api/orders/stats HTTP/1.1" 200 OK
2026-01-13 23:07:01,009 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - ROLLBACK
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-13 23:07:01,014 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:07:01,014 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:07:01,015 INFO sqlalchemy.engine.Engine [cached since 0.06462s ago] (10,)
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - [cached since 0.06462s ago] (10,)
2026-01-13 23:07:01,016 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s ORDER BY orders.created_at DESC) AS anon_1
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s ORDER BY orders.created_at DESC) AS anon_1
2026-01-13 23:07:01,016 INFO sqlalchemy.engine.Engine [cached since 0.0417s ago] (10,)
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - [cached since 0.0417s ago] (10,)
2026-01-13 23:07:01,018 INFO sqlalchemy.engine.Engine SELECT orders.id, orders.order_no, orders.user_id, orders.product_id, orders.product_type, orders.amount, orders.quantity, orders.status, orders.payment_method, orders.payment_time, orders.description, orders.created_at, orders.updated_at 
FROM orders 
WHERE orders.user_id = %s ORDER BY orders.created_at DESC 
 LIMIT %s, %s
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - SELECT orders.id, orders.order_no, orders.user_id, orders.product_id, orders.product_type, orders.amount, orders.quantity, orders.status, orders.payment_method, orders.payment_time, orders.description, orders.created_at, orders.updated_at 
FROM orders 
WHERE orders.user_id = %s ORDER BY orders.created_at DESC 
 LIMIT %s, %s
2026-01-13 23:07:01,018 INFO sqlalchemy.engine.Engine [generated in 0.00025s] (10, 0, 6)
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (10, 0, 6)
INFO:     127.0.0.1:50308 - "GET /api/orders/?page=1&size=6 HTTP/1.1" 200 OK
2026-01-13 23:07:01,020 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:07:01 - sqlalchemy.engine.Engine - INFO - ROLLBACK
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-13 23:14:22,902 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:22,902 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:22,902 INFO sqlalchemy.engine.Engine [cached since 442s ago] (10,)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] (10,)
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-13 23:14:22,904 INFO sqlalchemy.engine.Engine SELECT count(users.id) AS count_1 
FROM users
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users
2026-01-13 23:14:22,904 INFO sqlalchemy.engine.Engine [cached since 442s ago] ()
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] ()
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-13 23:14:22,905 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:22,906 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:22,906 INFO sqlalchemy.engine.Engine [cached since 442s ago] (10,)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] (10,)
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-13 23:14:22,906 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:22,907 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:22,907 INFO sqlalchemy.engine.Engine [cached since 442s ago] (10,)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] (10,)
2026-01-13 23:14:22,907 INFO sqlalchemy.engine.Engine SELECT count(users.id) AS count_1 
FROM users 
WHERE users.status = %s
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users 
WHERE users.status = %s
2026-01-13 23:14:22,907 INFO sqlalchemy.engine.Engine [cached since 442s ago] (1,)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] (1,)
2026-01-13 23:14:22,908 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:22,908 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:22,908 INFO sqlalchemy.engine.Engine [cached since 442s ago] (10,)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] (10,)
2026-01-13 23:14:22,909 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s) AS anon_1
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s) AS anon_1
2026-01-13 23:14:22,909 INFO sqlalchemy.engine.Engine [cached since 441.9s ago] (10,)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 441.9s ago] (10,)
2026-01-13 23:14:22,910 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s ORDER BY orders.created_at DESC) AS anon_1
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s ORDER BY orders.created_at DESC) AS anon_1
2026-01-13 23:14:22,910 INFO sqlalchemy.engine.Engine [cached since 441.9s ago] (10,)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 441.9s ago] (10,)
2026-01-13 23:14:22,910 INFO sqlalchemy.engine.Engine SELECT count(users.id) AS count_1 
FROM users 
WHERE date(users.created_at) = %s
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users 
WHERE date(users.created_at) = %s
2026-01-13 23:14:22,910 INFO sqlalchemy.engine.Engine [cached since 442s ago] (datetime.date(2026, 1, 13),)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] (datetime.date(2026, 1, 13),)
2026-01-13 23:14:22,911 INFO sqlalchemy.engine.Engine SELECT sum(orders.amount) AS sum_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s) AS anon_1, orders
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT sum(orders.amount) AS sum_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s) AS anon_1, orders
2026-01-13 23:14:22,911 INFO sqlalchemy.engine.Engine [cached since 441.9s ago] (10,)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 441.9s ago] (10,)
INFO:     127.0.0.1:35730 - "GET /api/users/transactions?page=1&size=6 HTTP/1.1" 200 OK
2026-01-13 23:14:22,912 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:14:22,914 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s AND orders.status = %s) AS anon_1
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s AND orders.status = %s) AS anon_1
2026-01-13 23:14:22,914 INFO sqlalchemy.engine.Engine [generated in 0.00017s] (10, 1)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (10, 1)
2026-01-13 23:14:22,914 INFO sqlalchemy.engine.Engine SELECT orders.id, orders.order_no, orders.user_id, orders.product_id, orders.product_type, orders.amount, orders.quantity, orders.status, orders.payment_method, orders.payment_time, orders.description, orders.created_at, orders.updated_at 
FROM orders 
WHERE orders.user_id = %s ORDER BY orders.created_at DESC 
 LIMIT %s, %s
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT orders.id, orders.order_no, orders.user_id, orders.product_id, orders.product_type, orders.amount, orders.quantity, orders.status, orders.payment_method, orders.payment_time, orders.description, orders.created_at, orders.updated_at 
FROM orders 
WHERE orders.user_id = %s ORDER BY orders.created_at DESC 
 LIMIT %s, %s
2026-01-13 23:14:22,914 INFO sqlalchemy.engine.Engine [cached since 441.9s ago] (10, 0, 6)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 441.9s ago] (10, 0, 6)
2026-01-13 23:14:22,915 INFO sqlalchemy.engine.Engine SELECT sum(members.points) AS sum_1 
FROM members
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT sum(members.points) AS sum_1 
FROM members
2026-01-13 23:14:22,915 INFO sqlalchemy.engine.Engine [cached since 442s ago] ()
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] ()
INFO:     127.0.0.1:35716 - "GET /api/orders/?page=1&size=6 HTTP/1.1" 200 OK
2026-01-13 23:14:22,916 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     127.0.0.1:35690 - "GET /api/users/stats HTTP/1.1" 200 OK
2026-01-13 23:14:22,916 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:14:22,917 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s AND orders.status = %s) AS anon_1
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s AND orders.status = %s) AS anon_1
2026-01-13 23:14:22,917 INFO sqlalchemy.engine.Engine [cached since 0.003522s ago] (10, 2)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 0.003522s ago] (10, 2)
INFO:     127.0.0.1:35700 - "GET /api/orders/stats HTTP/1.1" 200 OK
2026-01-13 23:14:22,918 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - ROLLBACK
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-13 23:14:22,923 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:22,923 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:22,923 INFO sqlalchemy.engine.Engine [cached since 442s ago] (10,)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] (10,)
INFO:     127.0.0.1:35738 - "GET /api/users/transactions?page=1&size=6 HTTP/1.1" 200 OK
2026-01-13 23:14:22,924 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - ROLLBACK
DEBUG: get_current_user called. Token: eyJhbGciOi...
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-13 23:14:22,934 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:22,934 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:22,934 INFO sqlalchemy.engine.Engine [cached since 442s ago] (10,)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] (10,)
2026-01-13 23:14:22,934 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:22,935 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:22,935 INFO sqlalchemy.engine.Engine [cached since 442s ago] (10,)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] (10,)
2026-01-13 23:14:22,935 INFO sqlalchemy.engine.Engine SELECT count(users.id) AS count_1 
FROM users
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users
2026-01-13 23:14:22,935 INFO sqlalchemy.engine.Engine [cached since 442s ago] ()
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] ()
2026-01-13 23:14:22,936 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s ORDER BY orders.created_at DESC) AS anon_1
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s ORDER BY orders.created_at DESC) AS anon_1
2026-01-13 23:14:22,936 INFO sqlalchemy.engine.Engine [cached since 442s ago] (10,)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] (10,)
2026-01-13 23:14:22,937 INFO sqlalchemy.engine.Engine SELECT count(users.id) AS count_1 
FROM users 
WHERE users.status = %s
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users 
WHERE users.status = %s
2026-01-13 23:14:22,937 INFO sqlalchemy.engine.Engine [cached since 442s ago] (1,)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] (1,)
2026-01-13 23:14:22,937 INFO sqlalchemy.engine.Engine SELECT orders.id, orders.order_no, orders.user_id, orders.product_id, orders.product_type, orders.amount, orders.quantity, orders.status, orders.payment_method, orders.payment_time, orders.description, orders.created_at, orders.updated_at 
FROM orders 
WHERE orders.user_id = %s ORDER BY orders.created_at DESC 
 LIMIT %s, %s
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT orders.id, orders.order_no, orders.user_id, orders.product_id, orders.product_type, orders.amount, orders.quantity, orders.status, orders.payment_method, orders.payment_time, orders.description, orders.created_at, orders.updated_at 
FROM orders 
WHERE orders.user_id = %s ORDER BY orders.created_at DESC 
 LIMIT %s, %s
2026-01-13 23:14:22,937 INFO sqlalchemy.engine.Engine [cached since 441.9s ago] (10, 0, 6)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 441.9s ago] (10, 0, 6)
2026-01-13 23:14:22,938 INFO sqlalchemy.engine.Engine SELECT count(users.id) AS count_1 
FROM users 
WHERE date(users.created_at) = %s
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users 
WHERE date(users.created_at) = %s
2026-01-13 23:14:22,938 INFO sqlalchemy.engine.Engine [cached since 442s ago] (datetime.date(2026, 1, 13),)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] (datetime.date(2026, 1, 13),)
INFO:     127.0.0.1:35762 - "GET /api/orders/?page=1&size=6 HTTP/1.1" 200 OK
2026-01-13 23:14:22,939 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:14:22,940 INFO sqlalchemy.engine.Engine SELECT sum(members.points) AS sum_1 
FROM members
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT sum(members.points) AS sum_1 
FROM members
2026-01-13 23:14:22,940 INFO sqlalchemy.engine.Engine [cached since 442s ago] ()
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] ()
DEBUG: get_current_user called. Token: eyJhbGciOi...
INFO:     127.0.0.1:35752 - "GET /api/users/stats HTTP/1.1" 200 OK
2026-01-13 23:14:22,941 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:14:22,942 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:22,942 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:22,942 INFO sqlalchemy.engine.Engine [cached since 442s ago] (10,)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] (10,)
2026-01-13 23:14:22,943 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s) AS anon_1
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s) AS anon_1
2026-01-13 23:14:22,943 INFO sqlalchemy.engine.Engine [cached since 442s ago] (10,)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 442s ago] (10,)
2026-01-13 23:14:22,944 INFO sqlalchemy.engine.Engine SELECT sum(orders.amount) AS sum_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s) AS anon_1, orders
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT sum(orders.amount) AS sum_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s) AS anon_1, orders
2026-01-13 23:14:22,944 INFO sqlalchemy.engine.Engine [cached since 441.9s ago] (10,)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 441.9s ago] (10,)
2026-01-13 23:14:22,945 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s AND orders.status = %s) AS anon_1
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s AND orders.status = %s) AS anon_1
2026-01-13 23:14:22,945 INFO sqlalchemy.engine.Engine [cached since 0.03143s ago] (10, 1)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 0.03143s ago] (10, 1)
2026-01-13 23:14:22,946 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s AND orders.status = %s) AS anon_1
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT orders.id AS id, orders.order_no AS order_no, orders.user_id AS user_id, orders.product_id AS product_id, orders.product_type AS product_type, orders.amount AS amount, orders.quantity AS quantity, orders.status AS status, orders.payment_method AS payment_method, orders.payment_time AS payment_time, orders.description AS description, orders.created_at AS created_at, orders.updated_at AS updated_at 
FROM orders 
WHERE orders.user_id = %s AND orders.status = %s) AS anon_1
2026-01-13 23:14:22,946 INFO sqlalchemy.engine.Engine [cached since 0.03238s ago] (10, 2)
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - [cached since 0.03238s ago] (10, 2)
INFO:     127.0.0.1:35776 - "GET /api/orders/stats HTTP/1.1" 200 OK
2026-01-13 23:14:22,947 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:14:22 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:14:30,794 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:30 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:30,794 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.username = %s
2026-01-13 23:14:30 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.username = %s
2026-01-13 23:14:30,794 INFO sqlalchemy.engine.Engine [cached since 450.3s ago] ('user2',)
2026-01-13 23:14:30 - sqlalchemy.engine.Engine - INFO - [cached since 450.3s ago] ('user2',)
2026-01-13 23:14:30,795 INFO sqlalchemy.engine.Engine SELECT members.user_id AS members_user_id, members.id AS members_id, members.member_level AS members_member_level, members.points AS members_points, members.balance AS members_balance, members.expired_at AS members_expired_at, members.created_at AS members_created_at, members.updated_at AS members_updated_at 
FROM members 
WHERE members.user_id IN (%s)
2026-01-13 23:14:30 - sqlalchemy.engine.Engine - INFO - SELECT members.user_id AS members_user_id, members.id AS members_id, members.member_level AS members_member_level, members.points AS members_points, members.balance AS members_balance, members.expired_at AS members_expired_at, members.created_at AS members_created_at, members.updated_at AS members_updated_at 
FROM members 
WHERE members.user_id IN (%s)
2026-01-13 23:14:30,795 INFO sqlalchemy.engine.Engine [cached since 450.3s ago] (10,)
2026-01-13 23:14:30 - sqlalchemy.engine.Engine - INFO - [cached since 450.3s ago] (10,)
2026-01-13 23:14:31,038 INFO sqlalchemy.engine.Engine INSERT INTO login_logs (user_id, auth_type, identifier, ip, user_agent, success, failure_reason) VALUES (%s, %s, %s, %s, %s, %s, %s)
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - INSERT INTO login_logs (user_id, auth_type, identifier, ip, user_agent, success, failure_reason) VALUES (%s, %s, %s, %s, %s, %s, %s)
2026-01-13 23:14:31,038 INFO sqlalchemy.engine.Engine [cached since 450.3s ago] (10, 'username', 'user2', '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36', 1, None)
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - [cached since 450.3s ago] (10, 'username', 'user2', '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36', 1, None)
2026-01-13 23:14:31,039 INFO sqlalchemy.engine.Engine COMMIT
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-13 23:14:31 - routers.auth - INFO - 用户登录成功: user2
INFO:     127.0.0.1:34172 - "POST /api/auth/login HTTP/1.1" 200 OK
2026-01-13 23:14:31,142 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:31,143 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:31,143 INFO sqlalchemy.engine.Engine [cached since 450.2s ago] (10,)
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - [cached since 450.2s ago] (10,)
2026-01-13 23:14:31,146 INFO sqlalchemy.engine.Engine SELECT DATABASE()
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - SELECT DATABASE()
2026-01-13 23:14:31,146 INFO sqlalchemy.engine.Engine [raw sql] {}
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2026-01-13 23:14:31,147 INFO sqlalchemy.engine.Engine SELECT @@sql_mode
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - SELECT @@sql_mode
2026-01-13 23:14:31,147 INFO sqlalchemy.engine.Engine [raw sql] {}
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2026-01-13 23:14:31,148 INFO sqlalchemy.engine.Engine SELECT @@lower_case_table_names
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - SELECT @@lower_case_table_names
2026-01-13 23:14:31,148 INFO sqlalchemy.engine.Engine [raw sql] {}
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2026-01-13 23:14:31,148 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:31,149 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-13 23:14:31,149 INFO sqlalchemy.engine.Engine [generated in 0.00018s] {}
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {}
2026-01-13 23:14:31 - routers.external_systems - INFO - 用户 user2 查询可访问的外部系统，返回 1 个系统
INFO:     127.0.0.1:34176 - "GET /api/external-systems/user/accessible HTTP/1.1" 200 OK
2026-01-13 23:14:31,151 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:14:31,152 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:14:31,178 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:31,178 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:31,178 INFO sqlalchemy.engine.Engine [cached since 450.2s ago] (10,)
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - [cached since 450.2s ago] (10,)
2026-01-13 23:14:31,180 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:31,180 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-13 23:14:31,180 INFO sqlalchemy.engine.Engine [cached since 0.03058s ago] {}
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - [cached since 0.03058s ago] {}
2026-01-13 23:14:31 - routers.external_systems - INFO - 用户 user2 查询可访问的外部系统，返回 1 个系统
INFO:     127.0.0.1:34192 - "GET /api/external-systems/user/accessible HTTP/1.1" 200 OK
2026-01-13 23:14:31,181 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:14:31,182 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:14:31 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     127.0.0.1:60854 - "GET /api/auth/me HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:60864 - "GET /api/auth/me HTTP/1.1" 404 Not Found
2026-01-13 23:14:39,868 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:39 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:39,869 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:39 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:39,869 INFO sqlalchemy.engine.Engine [cached since 458.9s ago] (10,)
2026-01-13 23:14:39 - sqlalchemy.engine.Engine - INFO - [cached since 458.9s ago] (10,)
2026-01-13 23:14:39,870 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:39 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:39,870 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-13 23:14:39 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-13 23:14:39,870 INFO sqlalchemy.engine.Engine [cached since 8.721s ago] {}
2026-01-13 23:14:39 - sqlalchemy.engine.Engine - INFO - [cached since 8.721s ago] {}
2026-01-13 23:14:39 - routers.external_systems - INFO - 用户 user2 查询可访问的外部系统，返回 1 个系统
INFO:     127.0.0.1:60876 - "GET /api/external-systems/user/accessible HTTP/1.1" 200 OK
2026-01-13 23:14:39,871 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:14:39 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:14:39,872 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:14:39 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:14:39,889 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:39 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:39,890 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:39 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:14:39,890 INFO sqlalchemy.engine.Engine [cached since 458.9s ago] (10,)
2026-01-13 23:14:39 - sqlalchemy.engine.Engine - INFO - [cached since 458.9s ago] (10,)
2026-01-13 23:14:39,891 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:14:39 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:14:39,891 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-13 23:14:39 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-13 23:14:39,891 INFO sqlalchemy.engine.Engine [cached since 8.742s ago] {}
2026-01-13 23:14:39 - sqlalchemy.engine.Engine - INFO - [cached since 8.742s ago] {}
2026-01-13 23:14:39 - routers.external_systems - INFO - 用户 user2 查询可访问的外部系统，返回 1 个系统
INFO:     127.0.0.1:60884 - "GET /api/external-systems/user/accessible HTTP/1.1" 200 OK
2026-01-13 23:14:39,892 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:14:39 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:14:39,893 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:14:39 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     127.0.0.1:60900 - "GET /api/auth/me HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:60906 - "GET /api/auth/me HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:38798 - "GET /api/auth/me HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:38812 - "GET /api/auth/me HTTP/1.1" 404 Not Found
2026-01-13 23:16:19,074 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:16:19 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:16:19,075 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:16:19 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:16:19,075 INFO sqlalchemy.engine.Engine [cached since 558.1s ago] (10,)
2026-01-13 23:16:19 - sqlalchemy.engine.Engine - INFO - [cached since 558.1s ago] (10,)
2026-01-13 23:16:19,076 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:16:19 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:16:19,076 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-13 23:16:19 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-13 23:16:19,076 INFO sqlalchemy.engine.Engine [cached since 107.9s ago] {}
2026-01-13 23:16:19 - sqlalchemy.engine.Engine - INFO - [cached since 107.9s ago] {}
2026-01-13 23:16:19 - routers.external_systems - INFO - 用户 user2 查询可访问的外部系统，返回 1 个系统
INFO:     127.0.0.1:38826 - "GET /api/external-systems/user/accessible HTTP/1.1" 200 OK
2026-01-13 23:16:19,078 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:16:19 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:16:19,078 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:16:19 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:16:19,088 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:16:19 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:16:19,088 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:16:19 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:16:19,088 INFO sqlalchemy.engine.Engine [cached since 558.1s ago] (10,)
2026-01-13 23:16:19 - sqlalchemy.engine.Engine - INFO - [cached since 558.1s ago] (10,)
2026-01-13 23:16:19,089 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:16:19 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:16:19,089 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-13 23:16:19 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-13 23:16:19,090 INFO sqlalchemy.engine.Engine [cached since 107.9s ago] {}
2026-01-13 23:16:19 - sqlalchemy.engine.Engine - INFO - [cached since 107.9s ago] {}
2026-01-13 23:16:19 - routers.external_systems - INFO - 用户 user2 查询可访问的外部系统，返回 1 个系统
INFO:     127.0.0.1:38842 - "GET /api/external-systems/user/accessible HTTP/1.1" 200 OK
2026-01-13 23:16:19,091 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:16:19 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:16:19,092 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:16:19 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:16:23,260 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:16:23 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:16:23,260 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:16:23 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:16:23,260 INFO sqlalchemy.engine.Engine [cached since 562.3s ago] (10,)
2026-01-13 23:16:23 - sqlalchemy.engine.Engine - INFO - [cached since 562.3s ago] (10,)
2026-01-13 23:16:23,261 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:16:23 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:16:23,261 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-13 23:16:23 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-13 23:16:23,261 INFO sqlalchemy.engine.Engine [cached since 112.1s ago] {}
2026-01-13 23:16:23 - sqlalchemy.engine.Engine - INFO - [cached since 112.1s ago] {}
2026-01-13 23:16:23 - routers.external_systems - INFO - 用户 user2 查询可访问的外部系统，返回 1 个系统
INFO:     127.0.0.1:38852 - "GET /api/external-systems/user/accessible HTTP/1.1" 200 OK
2026-01-13 23:16:23,262 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:16:23 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-13 23:16:23,262 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:16:23 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     127.0.0.1:55618 - "GET /api/auth/me HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:55626 - "GET /api/auth/me HTTP/1.1" 404 Not Found
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-13 23:19:10,953 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:19:10 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:19:10,954 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:19:10 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:19:10,954 INFO sqlalchemy.engine.Engine [cached since 730s ago] (10,)
2026-01-13 23:19:10 - sqlalchemy.engine.Engine - INFO - [cached since 730s ago] (10,)
INFO:     127.0.0.1:34934 - "GET /api/auth/profile HTTP/1.1" 200 OK
2026-01-13 23:19:10,955 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:19:10 - sqlalchemy.engine.Engine - INFO - ROLLBACK
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-13 23:19:11,024 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-13 23:19:11 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-13 23:19:11,024 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:19:11 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-13 23:19:11,024 INFO sqlalchemy.engine.Engine [cached since 730.1s ago] (10,)
2026-01-13 23:19:11 - sqlalchemy.engine.Engine - INFO - [cached since 730.1s ago] (10,)
INFO:     127.0.0.1:34940 - "GET /api/auth/profile HTTP/1.1" 200 OK
2026-01-13 23:19:11,025 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-13 23:19:11 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 00:04:46 - routers.auth - ERROR - 获取当前用户失败: 
Traceback (most recent call last):
  File "/root/aioffer/backend/utils/security.py", line 67, in decode_token
    payload = jwt.decode(
              ^^^^^^^^^^^
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 157, in decode
    _validate_claims(
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 481, in _validate_claims
    _validate_exp(claims, leeway=leeway)
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 314, in _validate_exp
    raise ExpiredSignatureError("Signature has expired.")
jose.exceptions.ExpiredSignatureError: Signature has expired.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/aioffer/backend/routers/auth.py", line 219, in get_current_user
    payload = SecurityManager.verify_access_token(token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 172, in verify_access_token
    return verify_access_token(token)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 81, in verify_access_token
    payload = decode_token(token)
              ^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 72, in decode_token
    raise HTTPException(
fastapi.exceptions.HTTPException
DEBUG: get_current_user called. Token: eyJhbGciOi...
DEBUG: get_current_user ERROR: 
INFO:     127.0.0.1:50112 - "GET /api/auth/profile HTTP/1.1" 401 Unauthorized
2026-01-14 00:04:46 - routers.auth - ERROR - 获取当前用户失败: 
Traceback (most recent call last):
  File "/root/aioffer/backend/utils/security.py", line 67, in decode_token
    payload = jwt.decode(
              ^^^^^^^^^^^
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 157, in decode
    _validate_claims(
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 481, in _validate_claims
    _validate_exp(claims, leeway=leeway)
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 314, in _validate_exp
    raise ExpiredSignatureError("Signature has expired.")
jose.exceptions.ExpiredSignatureError: Signature has expired.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/aioffer/backend/routers/auth.py", line 219, in get_current_user
    payload = SecurityManager.verify_access_token(token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 172, in verify_access_token
    return verify_access_token(token)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 81, in verify_access_token
    payload = decode_token(token)
              ^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 72, in decode_token
    raise HTTPException(
fastapi.exceptions.HTTPException
DEBUG: get_current_user called. Token: eyJhbGciOi...
DEBUG: get_current_user ERROR: 
INFO:     127.0.0.1:50128 - "GET /api/auth/profile HTTP/1.1" 401 Unauthorized
2026-01-14 00:24:07,008 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 00:24:07,008 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.username = %s
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.username = %s
2026-01-14 00:24:07,009 INFO sqlalchemy.engine.Engine [cached since 4627s ago] ('user2',)
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - [cached since 4627s ago] ('user2',)
2026-01-14 00:24:07,010 INFO sqlalchemy.engine.Engine SELECT members.user_id AS members_user_id, members.id AS members_id, members.member_level AS members_member_level, members.points AS members_points, members.balance AS members_balance, members.expired_at AS members_expired_at, members.created_at AS members_created_at, members.updated_at AS members_updated_at 
FROM members 
WHERE members.user_id IN (%s)
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - SELECT members.user_id AS members_user_id, members.id AS members_id, members.member_level AS members_member_level, members.points AS members_points, members.balance AS members_balance, members.expired_at AS members_expired_at, members.created_at AS members_created_at, members.updated_at AS members_updated_at 
FROM members 
WHERE members.user_id IN (%s)
2026-01-14 00:24:07,010 INFO sqlalchemy.engine.Engine [cached since 4627s ago] (10,)
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - [cached since 4627s ago] (10,)
2026-01-14 00:24:07,252 INFO sqlalchemy.engine.Engine INSERT INTO login_logs (user_id, auth_type, identifier, ip, user_agent, success, failure_reason) VALUES (%s, %s, %s, %s, %s, %s, %s)
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - INSERT INTO login_logs (user_id, auth_type, identifier, ip, user_agent, success, failure_reason) VALUES (%s, %s, %s, %s, %s, %s, %s)
2026-01-14 00:24:07,252 INFO sqlalchemy.engine.Engine [cached since 4626s ago] (10, 'username', 'user2', '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36', 1, None)
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - [cached since 4626s ago] (10, 'username', 'user2', '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36', 1, None)
2026-01-14 00:24:07,253 INFO sqlalchemy.engine.Engine COMMIT
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-14 00:24:07 - routers.auth - INFO - 用户登录成功: user2
INFO:     127.0.0.1:53246 - "POST /api/auth/login HTTP/1.1" 200 OK
2026-01-14 00:24:07,400 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 00:24:07,401 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 00:24:07,401 INFO sqlalchemy.engine.Engine [cached since 4626s ago] (10,)
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - [cached since 4626s ago] (10,)
2026-01-14 00:24:07,402 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 00:24:07,402 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-14 00:24:07,402 INFO sqlalchemy.engine.Engine [cached since 4176s ago] {}
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - [cached since 4176s ago] {}
2026-01-14 00:24:07 - routers.external_systems - INFO - 用户 user2 查询可访问的外部系统，返回 1 个系统
INFO:     127.0.0.1:53262 - "GET /api/external-systems/user/accessible HTTP/1.1" 200 OK
2026-01-14 00:24:07,403 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 00:24:07,404 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 00:24:07,417 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 00:24:07,417 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 00:24:07,417 INFO sqlalchemy.engine.Engine [cached since 4626s ago] (10,)
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - [cached since 4626s ago] (10,)
2026-01-14 00:24:07,418 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 00:24:07,419 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-14 00:24:07,419 INFO sqlalchemy.engine.Engine [cached since 4176s ago] {}
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - [cached since 4176s ago] {}
2026-01-14 00:24:07 - routers.external_systems - INFO - 用户 user2 查询可访问的外部系统，返回 1 个系统
INFO:     127.0.0.1:53270 - "GET /api/external-systems/user/accessible HTTP/1.1" 200 OK
2026-01-14 00:24:07,420 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 00:24:07,420 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 00:24:07 - sqlalchemy.engine.Engine - INFO - ROLLBACK
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-14 00:24:09,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 00:24:09 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 00:24:09,294 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 00:24:09 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 00:24:09,294 INFO sqlalchemy.engine.Engine [cached since 4628s ago] (10,)
2026-01-14 00:24:09 - sqlalchemy.engine.Engine - INFO - [cached since 4628s ago] (10,)
INFO:     127.0.0.1:53280 - "GET /api/auth/profile HTTP/1.1" 200 OK
2026-01-14 00:24:09,295 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 00:24:09 - sqlalchemy.engine.Engine - INFO - ROLLBACK
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-14 00:24:09,309 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 00:24:09 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 00:24:09,309 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 00:24:09 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 00:24:09,309 INFO sqlalchemy.engine.Engine [cached since 4628s ago] (10,)
2026-01-14 00:24:09 - sqlalchemy.engine.Engine - INFO - [cached since 4628s ago] (10,)
INFO:     127.0.0.1:53282 - "GET /api/auth/profile HTTP/1.1" 200 OK
2026-01-14 00:24:09,310 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 00:24:09 - sqlalchemy.engine.Engine - INFO - ROLLBACK
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-14 00:24:09,325 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 00:24:09 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 00:24:09,326 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 00:24:09 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 00:24:09,326 INFO sqlalchemy.engine.Engine [cached since 4628s ago] (10,)
2026-01-14 00:24:09 - sqlalchemy.engine.Engine - INFO - [cached since 4628s ago] (10,)
INFO:     127.0.0.1:53298 - "GET /api/auth/profile HTTP/1.1" 200 OK
2026-01-14 00:24:09,327 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 00:24:09 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:09:12 - routers.auth - ERROR - 获取当前用户失败: 
Traceback (most recent call last):
  File "/root/aioffer/backend/utils/security.py", line 67, in decode_token
    payload = jwt.decode(
              ^^^^^^^^^^^
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 157, in decode
    _validate_claims(
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 481, in _validate_claims
    _validate_exp(claims, leeway=leeway)
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 314, in _validate_exp
    raise ExpiredSignatureError("Signature has expired.")
jose.exceptions.ExpiredSignatureError: Signature has expired.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/aioffer/backend/routers/auth.py", line 219, in get_current_user
    payload = SecurityManager.verify_access_token(token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 172, in verify_access_token
    return verify_access_token(token)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 81, in verify_access_token
    payload = decode_token(token)
              ^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 72, in decode_token
    raise HTTPException(
fastapi.exceptions.HTTPException
DEBUG: get_current_user called. Token: eyJhbGciOi...
DEBUG: get_current_user ERROR: 
INFO:     127.0.0.1:33590 - "GET /api/users/stats HTTP/1.1" 401 Unauthorized
2026-01-14 07:09:13 - routers.auth - ERROR - 获取当前用户失败: 
Traceback (most recent call last):
  File "/root/aioffer/backend/utils/security.py", line 67, in decode_token
    payload = jwt.decode(
              ^^^^^^^^^^^
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 157, in decode
    _validate_claims(
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 481, in _validate_claims
    _validate_exp(claims, leeway=leeway)
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 314, in _validate_exp
    raise ExpiredSignatureError("Signature has expired.")
jose.exceptions.ExpiredSignatureError: Signature has expired.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/aioffer/backend/routers/auth.py", line 219, in get_current_user
    payload = SecurityManager.verify_access_token(token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 172, in verify_access_token
    return verify_access_token(token)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 81, in verify_access_token
    payload = decode_token(token)
              ^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 72, in decode_token
    raise HTTPException(
fastapi.exceptions.HTTPException
DEBUG: get_current_user called. Token: eyJhbGciOi...
DEBUG: get_current_user ERROR: 
INFO:     127.0.0.1:33592 - "GET /api/orders/stats HTTP/1.1" 401 Unauthorized
2026-01-14 07:09:13 - routers.auth - ERROR - 获取当前用户失败: 
Traceback (most recent call last):
  File "/root/aioffer/backend/utils/security.py", line 67, in decode_token
    payload = jwt.decode(
              ^^^^^^^^^^^
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 157, in decode
    _validate_claims(
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 481, in _validate_claims
    _validate_exp(claims, leeway=leeway)
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 314, in _validate_exp
    raise ExpiredSignatureError("Signature has expired.")
jose.exceptions.ExpiredSignatureError: Signature has expired.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/aioffer/backend/routers/auth.py", line 219, in get_current_user
    payload = SecurityManager.verify_access_token(token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 172, in verify_access_token
    return verify_access_token(token)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 81, in verify_access_token
    payload = decode_token(token)
              ^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 72, in decode_token
    raise HTTPException(
fastapi.exceptions.HTTPException
DEBUG: get_current_user called. Token: eyJhbGciOi...
DEBUG: get_current_user ERROR: 
INFO:     127.0.0.1:33604 - "GET /api/orders/?page=1&size=6 HTTP/1.1" 401 Unauthorized
2026-01-14 07:09:13 - routers.auth - ERROR - 获取当前用户失败: 
Traceback (most recent call last):
  File "/root/aioffer/backend/utils/security.py", line 67, in decode_token
    payload = jwt.decode(
              ^^^^^^^^^^^
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 157, in decode
    _validate_claims(
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 481, in _validate_claims
    _validate_exp(claims, leeway=leeway)
  File "/root/miniconda3/envs/aioffer/lib/python3.12/site-packages/jose/jwt.py", line 314, in _validate_exp
    raise ExpiredSignatureError("Signature has expired.")
jose.exceptions.ExpiredSignatureError: Signature has expired.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/aioffer/backend/routers/auth.py", line 219, in get_current_user
    payload = SecurityManager.verify_access_token(token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 172, in verify_access_token
    return verify_access_token(token)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 81, in verify_access_token
    payload = decode_token(token)
              ^^^^^^^^^^^^^^^^^^^
  File "/root/aioffer/backend/utils/security.py", line 72, in decode_token
    raise HTTPException(
fastapi.exceptions.HTTPException
DEBUG: get_current_user called. Token: eyJhbGciOi...
DEBUG: get_current_user ERROR: 
INFO:     127.0.0.1:33620 - "GET /api/users/transactions?page=1&size=6 HTTP/1.1" 401 Unauthorized
2026-01-14 07:09:24,806 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:09:24 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:09:24,807 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.username = %s
2026-01-14 07:09:24 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.username = %s
2026-01-14 07:09:24,807 INFO sqlalchemy.engine.Engine [cached since 2.894e+04s ago] ('user1',)
2026-01-14 07:09:24 - sqlalchemy.engine.Engine - INFO - [cached since 2.894e+04s ago] ('user1',)
2026-01-14 07:09:24,809 INFO sqlalchemy.engine.Engine SELECT members.user_id AS members_user_id, members.id AS members_id, members.member_level AS members_member_level, members.points AS members_points, members.balance AS members_balance, members.expired_at AS members_expired_at, members.created_at AS members_created_at, members.updated_at AS members_updated_at 
FROM members 
WHERE members.user_id IN (%s)
2026-01-14 07:09:24 - sqlalchemy.engine.Engine - INFO - SELECT members.user_id AS members_user_id, members.id AS members_id, members.member_level AS members_member_level, members.points AS members_points, members.balance AS members_balance, members.expired_at AS members_expired_at, members.created_at AS members_created_at, members.updated_at AS members_updated_at 
FROM members 
WHERE members.user_id IN (%s)
2026-01-14 07:09:24,809 INFO sqlalchemy.engine.Engine [cached since 2.894e+04s ago] (5,)
2026-01-14 07:09:24 - sqlalchemy.engine.Engine - INFO - [cached since 2.894e+04s ago] (5,)
2026-01-14 07:09:24,976 INFO sqlalchemy.engine.Engine INSERT INTO login_logs (user_id, auth_type, identifier, ip, user_agent, success, failure_reason) VALUES (%s, %s, %s, %s, %s, %s, %s)
2026-01-14 07:09:24 - sqlalchemy.engine.Engine - INFO - INSERT INTO login_logs (user_id, auth_type, identifier, ip, user_agent, success, failure_reason) VALUES (%s, %s, %s, %s, %s, %s, %s)
2026-01-14 07:09:24,976 INFO sqlalchemy.engine.Engine [cached since 2.894e+04s ago] (5, 'username', 'user1', '127.0.0.1', 'Mozilla/5.0 (iPhone; CPU iPhone OS 18_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/8.0.67(0x1800432e) NetType/WIFI Language/zh_CN', 1, None)
2026-01-14 07:09:24 - sqlalchemy.engine.Engine - INFO - [cached since 2.894e+04s ago] (5, 'username', 'user1', '127.0.0.1', 'Mozilla/5.0 (iPhone; CPU iPhone OS 18_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/8.0.67(0x1800432e) NetType/WIFI Language/zh_CN', 1, None)
2026-01-14 07:09:24,977 INFO sqlalchemy.engine.Engine COMMIT
2026-01-14 07:09:24 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-14 07:09:24 - routers.auth - INFO - 用户登录成功: user1
INFO:     127.0.0.1:50514 - "POST /api/auth/login HTTP/1.1" 200 OK
2026-01-14 07:09:25,115 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:09:25 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:09:25,116 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:09:25 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:09:25,116 INFO sqlalchemy.engine.Engine [cached since 2.894e+04s ago] (5,)
2026-01-14 07:09:25 - sqlalchemy.engine.Engine - INFO - [cached since 2.894e+04s ago] (5,)
2026-01-14 07:09:25,117 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:09:25 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:09:25,117 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-14 07:09:25 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-14 07:09:25,117 INFO sqlalchemy.engine.Engine [cached since 2.849e+04s ago] {}
2026-01-14 07:09:25 - sqlalchemy.engine.Engine - INFO - [cached since 2.849e+04s ago] {}
2026-01-14 07:09:25 - routers.external_systems - INFO - 用户 user1 查询可访问的外部系统，返回 1 个系统
INFO:     127.0.0.1:50520 - "GET /api/external-systems/user/accessible HTTP/1.1" 200 OK
2026-01-14 07:09:25,118 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:09:25 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:09:25,119 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:09:25 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:09:38,681 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:09:38 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:09:38,681 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:09:38 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:09:38,681 INFO sqlalchemy.engine.Engine [cached since 2.896e+04s ago] (5,)
2026-01-14 07:09:38 - sqlalchemy.engine.Engine - INFO - [cached since 2.896e+04s ago] (5,)
2026-01-14 07:09:38,683 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:09:38 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:09:38,684 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems 
WHERE external_systems.id = %(id_1)s AND external_systems.is_active = true 
 LIMIT %(param_1)s
2026-01-14 07:09:38 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems 
WHERE external_systems.id = %(id_1)s AND external_systems.is_active = true 
 LIMIT %(param_1)s
2026-01-14 07:09:38,684 INFO sqlalchemy.engine.Engine [generated in 0.00012s] {'id_1': 1, 'param_1': 1}
2026-01-14 07:09:38 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] {'id_1': 1, 'param_1': 1}
2026-01-14 07:09:38 - routers.external_systems - INFO - 外部系统 access_token 发放成功 user_id=5 system_id=1 duration_ms=2
INFO:     127.0.0.1:43292 - "GET /api/external-systems/1/access HTTP/1.1" 200 OK
2026-01-14 07:09:38,685 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:09:38 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:09:38,685 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:09:38 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:09:38,770 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:09:38 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:09:38,770 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:09:38 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:09:38,771 INFO sqlalchemy.engine.Engine [cached since 2.896e+04s ago] (5,)
2026-01-14 07:09:38 - sqlalchemy.engine.Engine - INFO - [cached since 2.896e+04s ago] (5,)
2026-01-14 07:09:38,772 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:09:38 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:09:38,772 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems 
WHERE external_systems.id = %(id_1)s AND external_systems.is_active = true 
 LIMIT %(param_1)s
2026-01-14 07:09:38 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems 
WHERE external_systems.id = %(id_1)s AND external_systems.is_active = true 
 LIMIT %(param_1)s
2026-01-14 07:09:38,772 INFO sqlalchemy.engine.Engine [cached since 0.08851s ago] {'id_1': 1, 'param_1': 1}
2026-01-14 07:09:38 - sqlalchemy.engine.Engine - INFO - [cached since 0.08851s ago] {'id_1': 1, 'param_1': 1}
2026-01-14 07:09:38 - routers.external_systems - INFO - 用户 user1 获取外部系统 曼彻斯特大学研究生专业入学评估系统 的集成配置
INFO:     127.0.0.1:43296 - "GET /api/external-systems/1/integration/config?integration_type=iframe HTTP/1.1" 200 OK
2026-01-14 07:09:38,773 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:09:38 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:09:38,773 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:09:38 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:11:12,458 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:11:12 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:11:12,458 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:11:12 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:11:12,458 INFO sqlalchemy.engine.Engine [cached since 2.905e+04s ago] (5,)
2026-01-14 07:11:12 - sqlalchemy.engine.Engine - INFO - [cached since 2.905e+04s ago] (5,)
2026-01-14 07:11:12,460 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:11:12 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:11:12,460 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems 
WHERE external_systems.id = %(id_1)s AND external_systems.is_active = true 
 LIMIT %(param_1)s
2026-01-14 07:11:12 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems 
WHERE external_systems.id = %(id_1)s AND external_systems.is_active = true 
 LIMIT %(param_1)s
2026-01-14 07:11:12,460 INFO sqlalchemy.engine.Engine [cached since 93.78s ago] {'id_1': 1, 'param_1': 1}
2026-01-14 07:11:12 - sqlalchemy.engine.Engine - INFO - [cached since 93.78s ago] {'id_1': 1, 'param_1': 1}
2026-01-14 07:11:12 - routers.external_systems - INFO - 外部系统 access_token 发放成功 user_id=5 system_id=1 duration_ms=1
INFO:     127.0.0.1:41026 - "GET /api/external-systems/1/access HTTP/1.1" 200 OK
2026-01-14 07:11:12,462 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:11:12 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:11:12,462 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:11:12 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:11:12,567 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:11:12 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:11:12,567 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:11:12 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:11:12,567 INFO sqlalchemy.engine.Engine [cached since 2.905e+04s ago] (5,)
2026-01-14 07:11:12 - sqlalchemy.engine.Engine - INFO - [cached since 2.905e+04s ago] (5,)
2026-01-14 07:11:12,568 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:11:12 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:11:12,568 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems 
WHERE external_systems.id = %(id_1)s AND external_systems.is_active = true 
 LIMIT %(param_1)s
2026-01-14 07:11:12 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems 
WHERE external_systems.id = %(id_1)s AND external_systems.is_active = true 
 LIMIT %(param_1)s
2026-01-14 07:11:12,569 INFO sqlalchemy.engine.Engine [cached since 93.89s ago] {'id_1': 1, 'param_1': 1}
2026-01-14 07:11:12 - sqlalchemy.engine.Engine - INFO - [cached since 93.89s ago] {'id_1': 1, 'param_1': 1}
2026-01-14 07:11:12 - routers.external_systems - INFO - 用户 user1 获取外部系统 曼彻斯特大学研究生专业入学评估系统 的集成配置
INFO:     127.0.0.1:41040 - "GET /api/external-systems/1/integration/config?integration_type=iframe HTTP/1.1" 200 OK
2026-01-14 07:11:12,570 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:11:12 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:11:12,570 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:11:12 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:11:24,631 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:11:24 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:11:24,631 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:11:24 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:11:24,631 INFO sqlalchemy.engine.Engine [cached since 2.906e+04s ago] (5,)
2026-01-14 07:11:24 - sqlalchemy.engine.Engine - INFO - [cached since 2.906e+04s ago] (5,)
2026-01-14 07:11:24,633 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:11:24 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:11:24,633 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems 
WHERE external_systems.id = %(id_1)s AND external_systems.is_active = true 
 LIMIT %(param_1)s
2026-01-14 07:11:24 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems 
WHERE external_systems.id = %(id_1)s AND external_systems.is_active = true 
 LIMIT %(param_1)s
2026-01-14 07:11:24,633 INFO sqlalchemy.engine.Engine [cached since 105.9s ago] {'id_1': 1, 'param_1': 1}
2026-01-14 07:11:24 - sqlalchemy.engine.Engine - INFO - [cached since 105.9s ago] {'id_1': 1, 'param_1': 1}
2026-01-14 07:11:24 - routers.external_systems - INFO - 外部系统 access_token 发放成功 user_id=5 system_id=1 duration_ms=1
INFO:     127.0.0.1:34768 - "GET /api/external-systems/1/access HTTP/1.1" 200 OK
2026-01-14 07:11:24,634 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:11:24 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:11:24,635 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:11:24 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:11:24,723 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:11:24 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:11:24,723 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:11:24 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:11:24,723 INFO sqlalchemy.engine.Engine [cached since 2.906e+04s ago] (5,)
2026-01-14 07:11:24 - sqlalchemy.engine.Engine - INFO - [cached since 2.906e+04s ago] (5,)
2026-01-14 07:11:24,724 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:11:24 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:11:24,725 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems 
WHERE external_systems.id = %(id_1)s AND external_systems.is_active = true 
 LIMIT %(param_1)s
2026-01-14 07:11:24 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems 
WHERE external_systems.id = %(id_1)s AND external_systems.is_active = true 
 LIMIT %(param_1)s
2026-01-14 07:11:24,725 INFO sqlalchemy.engine.Engine [cached since 106s ago] {'id_1': 1, 'param_1': 1}
2026-01-14 07:11:24 - sqlalchemy.engine.Engine - INFO - [cached since 106s ago] {'id_1': 1, 'param_1': 1}
2026-01-14 07:11:24 - routers.external_systems - INFO - 用户 user1 获取外部系统 曼彻斯特大学研究生专业入学评估系统 的集成配置
INFO:     127.0.0.1:34782 - "GET /api/external-systems/1/integration/config?integration_type=iframe HTTP/1.1" 200 OK
2026-01-14 07:11:24,726 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:11:24 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:11:24,726 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:11:24 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:11:31,023 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:11:31 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:11:31,023 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:11:31 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:11:31,023 INFO sqlalchemy.engine.Engine [cached since 2.907e+04s ago] (5,)
2026-01-14 07:11:31 - sqlalchemy.engine.Engine - INFO - [cached since 2.907e+04s ago] (5,)
2026-01-14 07:11:31,024 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:11:31 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:11:31,024 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-14 07:11:31 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-14 07:11:31,025 INFO sqlalchemy.engine.Engine [cached since 2.862e+04s ago] {}
2026-01-14 07:11:31 - sqlalchemy.engine.Engine - INFO - [cached since 2.862e+04s ago] {}
2026-01-14 07:11:31 - routers.external_systems - INFO - 用户 user1 查询可访问的外部系统，返回 1 个系统
INFO:     127.0.0.1:34790 - "GET /api/external-systems/user/accessible HTTP/1.1" 200 OK
2026-01-14 07:11:31,025 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:11:31 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:11:31,026 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:11:31 - sqlalchemy.engine.Engine - INFO - ROLLBACK
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-14 07:11:58,873 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:11:58 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:11:58,873 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:11:58 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:11:58,873 INFO sqlalchemy.engine.Engine [cached since 2.91e+04s ago] (5,)
2026-01-14 07:11:58 - sqlalchemy.engine.Engine - INFO - [cached since 2.91e+04s ago] (5,)
INFO:     127.0.0.1:59960 - "GET /api/auth/profile HTTP/1.1" 200 OK
2026-01-14 07:11:58,874 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:11:58 - sqlalchemy.engine.Engine - INFO - ROLLBACK
DEBUG: get_current_user called. Token: eyJhbGciOi...
2026-01-14 07:11:58,982 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:11:58 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:11:58,982 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:11:58 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:11:58,982 INFO sqlalchemy.engine.Engine [cached since 2.91e+04s ago] (5,)
2026-01-14 07:11:58 - sqlalchemy.engine.Engine - INFO - [cached since 2.91e+04s ago] (5,)
INFO:     127.0.0.1:59970 - "GET /api/auth/profile HTTP/1.1" 200 OK
2026-01-14 07:11:58,983 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:11:58 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:12:08,870 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:12:08 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:12:08,871 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:12:08 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:12:08,871 INFO sqlalchemy.engine.Engine [cached since 2.911e+04s ago] (5,)
2026-01-14 07:12:08 - sqlalchemy.engine.Engine - INFO - [cached since 2.911e+04s ago] (5,)
2026-01-14 07:12:08,872 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:12:08 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:12:08,872 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-14 07:12:08 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems
2026-01-14 07:12:08,872 INFO sqlalchemy.engine.Engine [cached since 2.866e+04s ago] {}
2026-01-14 07:12:08 - sqlalchemy.engine.Engine - INFO - [cached since 2.866e+04s ago] {}
2026-01-14 07:12:08 - routers.external_systems - INFO - 用户 user1 查询可访问的外部系统，返回 1 个系统
INFO:     127.0.0.1:32866 - "GET /api/external-systems/user/accessible HTTP/1.1" 200 OK
2026-01-14 07:12:08,873 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:12:08 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:12:08,874 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:12:08 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:12:33,514 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:12:33 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:12:33,514 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:12:33 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:12:33,514 INFO sqlalchemy.engine.Engine [cached since 2.913e+04s ago] (5,)
2026-01-14 07:12:33 - sqlalchemy.engine.Engine - INFO - [cached since 2.913e+04s ago] (5,)
2026-01-14 07:12:33,516 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:12:33 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:12:33,516 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems 
WHERE external_systems.id = %(id_1)s AND external_systems.is_active = true 
 LIMIT %(param_1)s
2026-01-14 07:12:33 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems 
WHERE external_systems.id = %(id_1)s AND external_systems.is_active = true 
 LIMIT %(param_1)s
2026-01-14 07:12:33,516 INFO sqlalchemy.engine.Engine [cached since 174.8s ago] {'id_1': 1, 'param_1': 1}
2026-01-14 07:12:33 - sqlalchemy.engine.Engine - INFO - [cached since 174.8s ago] {'id_1': 1, 'param_1': 1}
2026-01-14 07:12:33 - routers.external_systems - INFO - 外部系统 access_token 发放成功 user_id=5 system_id=1 duration_ms=1
INFO:     127.0.0.1:37674 - "GET /api/external-systems/1/access HTTP/1.1" 200 OK
2026-01-14 07:12:33,518 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:12:33 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:12:33,518 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:12:33 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:12:33,609 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:12:33 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:12:33,609 INFO sqlalchemy.engine.Engine SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:12:33 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.username, users.email, users.password_hash, users.full_name, users.avatar_url, users.phone, users.status, users.user_type, users.created_at, users.updated_at 
FROM users 
WHERE users.id = %s
2026-01-14 07:12:33,609 INFO sqlalchemy.engine.Engine [cached since 2.913e+04s ago] (5,)
2026-01-14 07:12:33 - sqlalchemy.engine.Engine - INFO - [cached since 2.913e+04s ago] (5,)
2026-01-14 07:12:33,610 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-14 07:12:33 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-14 07:12:33,611 INFO sqlalchemy.engine.Engine SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems 
WHERE external_systems.id = %(id_1)s AND external_systems.is_active = true 
 LIMIT %(param_1)s
2026-01-14 07:12:33 - sqlalchemy.engine.Engine - INFO - SELECT external_systems.id AS external_systems_id, external_systems.name AS external_systems_name, external_systems.system_type AS external_systems_system_type, external_systems.page_url AS external_systems_page_url, external_systems.api_key AS external_systems_api_key, external_systems.api_secret AS external_systems_api_secret, external_systems.endpoint_url AS external_systems_endpoint_url, external_systems.config AS external_systems_config, external_systems.is_active AS external_systems_is_active, external_systems.created_at AS external_systems_created_at, external_systems.updated_at AS external_systems_updated_at 
FROM external_systems 
WHERE external_systems.id = %(id_1)s AND external_systems.is_active = true 
 LIMIT %(param_1)s
2026-01-14 07:12:33,611 INFO sqlalchemy.engine.Engine [cached since 174.9s ago] {'id_1': 1, 'param_1': 1}
2026-01-14 07:12:33 - sqlalchemy.engine.Engine - INFO - [cached since 174.9s ago] {'id_1': 1, 'param_1': 1}
2026-01-14 07:12:33 - routers.external_systems - INFO - 用户 user1 获取外部系统 曼彻斯特大学研究生专业入学评估系统 的集成配置
INFO:     127.0.0.1:37684 - "GET /api/external-systems/1/integration/config?integration_type=iframe HTTP/1.1" 200 OK
2026-01-14 07:12:33,612 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:12:33 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2026-01-14 07:12:33,613 INFO sqlalchemy.engine.Engine ROLLBACK
2026-01-14 07:12:33 - sqlalchemy.engine.Engine - INFO - ROLLBACK
