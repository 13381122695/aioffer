# AIOffer 项目说明文档（全生命周期管理载体）

创建日期：2026-01-09  
用途说明：本文件用于统一管理项目规划、实施方案、进度记录；每次开始开发前先阅读并对齐。

## 一、项目规划

### 1.1 项目目标

- 交付一个会员管理系统（Admin Console），覆盖用户、会员、权限、菜单、订单、外部系统集成等核心能力
- 前后端分离：前端提供管理界面；后端提供 REST API（REST 接口）
- 权限采用 RBAC（Role-Based Access Control，基于角色的访问控制），菜单与权限绑定

### 1.2 业务范围（本期以现有代码为准，不扩展范围）

- 认证与鉴权（Auth & JWT）：登录、注册、Token 刷新、权限校验
- 用户管理（Users）：增删改查、启用/禁用、基础资料
- 会员管理（Members）：会员等级、积分、余额、到期时间（用户扩展信息）
- 权限管理（Roles & Permissions）：角色管理、权限分配
- 菜单管理（Menus）：菜单树、按用户权限过滤菜单
- 订单管理（Orders）：订单列表、状态、支付与积分交易记录
- 外部系统（External Systems）：外部系统登记、集成配置（iframe/SSO）

### 1.3 技术栈现状（现状梳理）

**后端（Backend）**
- Python 3.8+
- FastAPI（异步 Web 框架）
- SQLAlchemy 2.x Async（异步 ORM）
- Pydantic 2.x（数据校验/序列化）
- 数据库：SQLite（默认）/ MySQL（支持）
- Redis（缓存/队列依赖存在，但是否启用以配置为准）

**前端（Frontend）**
- React 18 + TypeScript
- Ant Design 5.x（UI 组件库）
- Vite 6（构建/Dev Server）
- Zustand（状态管理）
- React Router（路由）
- Axios（HTTP 客户端）

### 1.4 里程碑与时间节点（可执行）

> 原则：不延期、不超出计划、不出错。若节点调整，需同步更新本节与进度记录。

- M1（2026-01-09）：完成项目现状梳理与文档体系落地（说明文档 + 6A 文档集）
- M2（2026-01-10）：关键链路自检（用户/角色/菜单/订单/外部系统），修复阻塞性缺陷
- M3（2026-01-11）：补齐最小可用测试（pytest + 前端 lint/typecheck），形成可回归基线

## 二、实施方案

### 2.1 目录结构（以仓库实际为准）

```
aioffer/
├── backend/                 # 后端 FastAPI
│   ├── config/              # 配置与数据库初始化
│   ├── models/              # SQLAlchemy 模型
│   ├── routers/             # API 路由
│   ├── schemas/             # Pydantic Schema
│   ├── services/            # 业务服务（如存在）
│   ├── utils/               # 工具函数（响应、日志、安全等）
│   └── main.py              # 入口
├── frontend/                # 前端 React
│   ├── src/
│   │   ├── pages/           # 页面
│   │   ├── services/        # API 封装
│   │   ├── stores/          # Zustand store
│   │   ├── utils/           # request 等工具
│   │   ├── layouts/         # 布局
│   │   └── App.tsx          # 应用入口
└── docs/                    # 6A 文档输出目录（本次新增）
```

### 2.2 架构与数据流（概要）

- 前端通过 `frontend/src/utils/request` 统一发起 API 请求
- 后端 `backend/main.py` 注册路由前缀 `/api/*`
- 权限：用户（User）通过关联表绑定角色（Role），角色关联权限（Permission）
- 菜单：菜单（Menu）通过权限 code 控制可见性（后端按用户权限返回菜单）

### 2.3 开发流程（与规则对齐）

- 需求 → 采用 `<MCPsequential thinking>` 顺序化拆解 ToDo（任务清单）
- 资料/库文档 → 优先使用 `<MCPContext7>` 获取最新示例与用法
- 交付闭环 → 每完成一项功能/BUG 修复：
  - 完成自检（编译/类型检查/lint/必要的用例）
  - 更新本文件「进度记录」
  - 必要时同步更新 `docs/项目梳理/*` 的验收记录

## 三、进度记录

> 记录格式建议：日期 / 内容 / 结果 / 证据（文件链接或命令输出摘要）/ 风险与后续

### 2026-01-09

- 内容：角色/外部系统/用户保存/角色页面稳定性修复与梳理
- 结果：
  - 修复角色列表接口异常与权限列表路由顺序风险
  - 修复外部系统接口的 Pydantic v1/v2 不兼容问题
  - 修复创建用户接口字段处理与缩进问题
  - 修复角色页面 `Roles.tsx` 状态命名与服务调用方式
- 证据（代码位置）：
  - 后端角色路由：[roles.py](file:///root/aioffer/backend/routers/roles.py)
  - 后端用户路由：[users.py](file:///root/aioffer/backend/routers/users.py)
  - 后端外部系统路由：[external_systems.py](file:///root/aioffer/backend/routers/external_systems.py)
  - 前端角色页面：[Roles.tsx](file:///root/aioffer/frontend/src/pages/settings/Roles.tsx)
- 风险与后续：
  - 需要完成后端语法/类型自检与前端 lint/typecheck，确保“绝不允许出错”
  - 外部系统路由存在前缀/依赖风格不一致风险（需在 TODO 中列为后续治理项）
